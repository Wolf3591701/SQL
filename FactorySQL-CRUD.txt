CREATE DATABASE Factory;

USE Factory;

CREATE TABLE CARBRAND (
	Id uniqueidentifier PRIMARY KEY NOT NULL,
	BrandName varchar(50) NOT NULL
);

CREATE TABLE CARMODEL (
	Id uniqueidentifier PRIMARY KEY NOT NULL,
	Named varchar(50) NOT NULL,
	CarBrandId uniqueidentifier NOT NULL
	CONSTRAINT FK_CARBRAND_CARMODEL_CarBrandId FOREIGN KEY (CarBrandId) REFERENCES CARBRAND (Id)
);


INSERT INTO CARBRAND VALUES
	(newid(),'Opel'),
	(newid(),'Renault'),
	(newid(),'Ford');


INSERT INTO CARMODEL VALUES
	(newid(),'Corsa',(SELECT Id FROM CARBRAND WHERE Named='Opel')),
	(newid(),'Focus',(SELECT Id FROM CARBRAND WHERE Named='Ford')),
	(newid(),'Megane',(SELECT Id FROM CARBRAND WHERE Named='Renault'));


--CRUD


--CREATE
INSERT INTO CARMODEL
VALUES (NEWID(), 'Camry', (SELECT Id FROM CARBRAND WHERE Named='Toyota'));


-- READ
SELECT * FROM CARBRAND 
-- Inner Join
SELECT CARMODEL.Id, CARMODEL.Named AS ModelName, CARBRAND.Named AS BrandName
FROM CARMODEL
INNER JOIN CARBRAND ON CARMODEL.CarBrandId = CARBRAND.Id;

-- Left Join
SELECT CARMODEL.Id, CARMODEL.Named AS ModelName, CARBRAND.Named AS BrandName
FROM CARMODEL
LEFT JOIN CARBRAND ON CARMODEL.CarBrandId = CARBRAND.Id;

-- Right Join
SELECT CARMODEL.Id, CARMODEL.Named AS ModelName, CARBRAND.Named AS BrandName
FROM CARMODEL
RIGHT JOIN CARBRAND ON CARMODEL.CarBrandId = CARBRAND.Id;

-- Full Outer Join
SELECT CARMODEL.Id, CARMODEL.Named AS ModelName, CARBRAND.Named AS BrandName
FROM CARMODEL
FULL OUTER JOIN CARBRAND ON CARMODEL.CarBrandId = CARBRAND.Id;

-- UPDATE
UPDATE CARMODEL
SET Named = 'Fiesta'
WHERE Named = 'Focus';

-- DELETE
DELETE FROM CARBRAND
WHERE Named = 'Opel';

CREATE VIEW "MODELOVERVIEW" AS (
SELECT na.BrandName, nm.Named, nm.NumberSold
FROM CARBRAND na
INNER JOIN CARMODEL nm ON nm.CarBrandId=na.Id
);
